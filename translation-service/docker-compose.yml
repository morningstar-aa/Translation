version: '3.8'

services:
  # LibreTranslate 翻译引擎
  libretranslate:
    image: libretranslate/libretranslate:latest
    container_name: libretranslate
    restart: unless-stopped
    ports:
      - "5000:5000"
    environment:
      # 语言设置：只下载中英文以节省空间
      - LT_LOAD_ONLY=en,zh
      # 禁用请求限制
      - LT_DISABLE_FILES_TRANSLATION=true
      - LT_SUGGESTIONS=false
    volumes:
      - libretranslate_data:/home/libretranslate/.local/share
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/languages"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Java 翻译服务
  translation-service:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: translation-service
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      - LIBRETRANSLATE_URL=http://libretranslate:5000
      - SPRING_PROFILES_ACTIVE=prod
    depends_on:
      libretranslate:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  libretranslate_data:

networks:
  default:
    name: translation-network
